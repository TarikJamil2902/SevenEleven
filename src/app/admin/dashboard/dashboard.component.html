<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1>Admin Dashboard</h1>
      <span class="last-updated">Last updated: {{ lastUpdated | date:'medium' }}</span>
    </div>
    <div class="header-right">
      <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="User menu">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #userMenu="matMenu">
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>
  </header>

  <main class="dashboard-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <mat-card class="stat-card" *ngIf="!loading">
        <mat-card-content>
          <div class="stat-icon orders">
            <mat-icon>shopping_cart</mat-icon>
          </div>
          <div class="stat-info">
            <h3>Orders</h3>
            <p class="stat-number">{{ stats.orders || 0 }}</p>
            <span class="stat-change positive">+12.5% from last month</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card" *ngIf="!loading">
        <mat-card-content>
          <div class="stat-icon revenue">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="stat-info">
            <h3>Revenue</h3>
            <p class="stat-number">${{ (stats.revenue || 0) | number:'1.2-2' }}</p>
            <span class="stat-change positive">+8.3% from last month</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card" *ngIf="!loading">
        <mat-card-content>
          <div class="stat-icon users">
            <mat-icon>people</mat-icon>
          </div>
          <div class="stat-info">
            <h3>Users</h3>
            <p class="stat-number">{{ stats.users || 0 }}</p>
            <span class="stat-change positive">+5.2% from last month</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card" *ngIf="!loading">
        <mat-card-content>
          <div class="stat-icon products">
            <mat-icon>inventory_2</mat-icon>
          </div>
          <div class="stat-info">
            <h3>Products</h3>
            <p class="stat-number">{{ stats.products || 0 }}</p>
            <span class="stat-change negative">-2.1% from last month</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Loading Shimmer Effect -->
      <ng-container *ngIf="loading">
        <div class="stat-card loading-shimmer" style="height: 120px; border-radius: 8px;" *ngFor="let i of [1,2,3,4]"></div>
      </ng-container>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Sales Overview</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <ng-container *ngIf="!loading; else chartLoading">
              <canvas #salesChart></canvas>
            </ng-container>
            <ng-template #chartLoading>
              <div class="loading-shimmer" style="width: 100%; height: 100%;"></div>
            </ng-template>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Revenue Sources</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <ng-container *ngIf="!loading; else revenueLoading">
              <canvas #revenueChart></canvas>
            </ng-container>
            <ng-template #revenueLoading>
              <div class="loading-shimmer" style="width: 100%; height: 100%;"></div>
            </ng-template>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Orders -->
    <mat-card class="recent-orders">
      <mat-card-header>
        <mat-card-title>Recent Orders</mat-card-title>
        <button mat-button color="primary" (click)="viewAllOrders()">View All</button>
      </mat-card-header>
      <mat-card-content>
        <div class="table-responsive">
          <ng-container *ngIf="!loading; else tableLoading">
            <table mat-table [dataSource]="recentOrders">
            <!-- Order ID Column -->
            <ng-container matColumnDef="orderId">
              <th mat-header-cell *matHeaderCellDef>Order ID</th>
              <td mat-cell *matCellDef="let order">{{ order.id }}</td>
            </ng-container>

            <!-- Customer Column -->
            <ng-container matColumnDef="customer">
              <th mat-header-cell *matHeaderCellDef>Customer</th>
              <td mat-cell *matCellDef="let order">{{ order.customer }}</td>
            </ng-container>

            <!-- Product Column -->
            <ng-container matColumnDef="product">
              <th mat-header-cell *matHeaderCellDef>Product</th>
              <td mat-cell *matCellDef="let order">{{ order.product }}</td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let order">{{ order.date | date:'mediumDate' }}</td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let order">${{ order.amount | number:'1.2-2' }}</td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let order">
                <span class="status-badge" [ngClass]="order.status.toLowerCase()">
                  {{ order.status }}
                </span>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </ng-container>

          <ng-template #tableLoading>
            <div *ngFor="let i of [1,2,3,4,5]" class="loading-shimmer" style="height: 60px; margin-bottom: 8px; border-radius: 4px;"></div>
          </ng-template>

          <div class="no-orders" *ngIf="!loading && (!recentOrders || recentOrders.length === 0)">
            <mat-icon>shopping_cart_off</mat-icon>
            <p>No recent orders found</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </main>
</div>